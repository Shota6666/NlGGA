<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Game Over Results</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&amp;display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#FFC107", // Amber/Yellow from the screenshot
                        secondary: "#FF9800", // Orange accent
                        "background-light": "#F9FAFB", // Light gray/white
                        "background-dark": "#1F2937", // Dark gray
                        "surface-light": "#FFFFFF",
                        "surface-dark": "#374151",
                    },
                    fontFamily: {
                        display: ["'Noto Sans TC'", "sans-serif"],
                    },
                    borderRadius: {
                        DEFAULT: "1rem",
                        'xl': '1.5rem',
                        '2xl': '2rem',
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.1)',
                        'glow': '0 0 15px rgba(255, 193, 7, 0.5)',
                    }
                },
            },
        };
    </script>
    <style>
        body {
            font-family: "Noto Sans TC", sans-serif
        }

        .text-stroke {
            -webkit-text-stroke: 1px white
        }

        .blob-bg {
            background-image: url(https://lh3.googleusercontent.com/aida-public/AB6AXuBXxI-dhSpbs6Q-T0LRM3xXs3QuY8fnb157fbLQCZgq_E16Jnu7zx3ztMKoax1of8baAS60y5E1FVFmOO99SJom04du2BxS8D9mAEvqROGQTH61w4HjFOG90ePovYgFAwdMu5UGJZOFxsQ_IghW21qYkhKNW_j_2jssVrT_9r5Sjuj45u-sbPm13QXgHBjpGxOMuxPhmx_b1tlpFoDgkaKPtb1DdvHeCamn_VTXj-V1UjLj19-Ghg5HZ6tMxhH-W6LW44sMGz1F);
            background-repeat: no-repeat;
            background-position: center
        }
    </style>
    <style>
        body {
            min-height: max(884px, 100dvh);
        }
    </style>
    <script src="js/global_audio.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        @keyframes flash {
            0% {
                opacity: 0.8;
            }

            100% {
                opacity: 0;
            }
        }

        .flash-overlay {
            position: fixed;
            inset: 0;
            background: white;
            z-index: 100;
            pointer-events: none;
            animation: flash 0.5s ease-out forwards;
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark min-h-screen flex flex-col items-center justify-between overflow-hidden relative transition-colors duration-300">
    <main
        class="w-full max-w-md h-full flex flex-col flex-grow relative bg-background-light dark:bg-background-dark shadow-2xl mx-auto min-h-screen">
        <div
            class="relative w-full h-[60vh] bg-gray-200 dark:bg-gray-800 overflow-hidden flex items-center justify-center">
            <div
                class="absolute inset-0 bg-gradient-to-b from-gray-300 to-gray-200 dark:from-gray-700 dark:to-gray-800 opacity-50">
            </div>
            <div class="relative z-10 w-full h-full p-8 flex items-center justify-center">
                <img alt="Stack of toy ducks" class="object-contain h-full w-full drop-shadow-2xl filter brightness-110"
                    src="https://lh3.googleusercontent.com/aida-public/AB6AXuAtwd0xMoESQcKmVrBX8NcdLj2uVsu7LhMRWZA0r6zswJE1FXfU3UuUOuAKBij-L9gTww01xeNoka1e8H_XjLPYBTTZutB40fGDSvOT9KOpa49XZcwiF5tQSk_-7S0qgjeE06RJZ6wPpOAQCOIjAIuV2fNVAL-nTDcBFhAsB3lCkTWqZjfgsWsw6kFUKbjSEpy1PiW2Wombc2_ZunDNAaWFuyrPs-ZVmzUehSf0NWpSzDxLEf86yg-aRzTwKffIJLUo1TsRmb2e" />
            </div>
            <button id="btn-share"
                class="absolute bottom-6 right-6 z-20 bg-primary hover:bg-yellow-400 text-white font-bold py-3 px-6 rounded-full shadow-lg transform transition-transform active:scale-95 flex items-center gap-2 animate-bounce-slow">
                <span class="material-icons-round text-xl">camera_alt</span>
                <span>拍照分享 !</span>
            </button>
            <div class="absolute inset-4 border-2 border-white/50 dark:border-white/20 rounded-3xl pointer-events-none">
            </div>
        </div>
        <div
            class="flex-grow bg-surface-light dark:bg-surface-dark rounded-t-[2.5rem] -mt-8 relative z-30 p-8 pb-12 shadow-[0_-10px_40px_rgba(0,0,0,0.05)] flex flex-col items-center justify-around transition-colors duration-300">
            <div class="text-center space-y-2 mt-4">
                <h1 class="text-3xl font-black text-primary tracking-wide">
                    <span
                        class="block text-xl text-gray-400 dark:text-gray-500 font-bold mb-1 uppercase tracking-widest text-sm">Game
                        Over</span>
                    共疊 <span id="final-score" class="text-4xl text-secondary">12</span> 層 !
                </h1>
                <h2 class="text-2xl font-black text-primary tracking-wide">
                    再玩一次 !
                </h2>
            </div>
            <div class="w-full flex items-center justify-between gap-6 mt-8 px-4">
                <button data-nav-target="game_countdown_screen.html"
                    class="group relative flex items-center justify-center w-16 h-16 rounded-full bg-white dark:bg-gray-700 border-2 border-primary text-primary shadow-soft hover:shadow-glow transition-all duration-300 transform active:scale-90">
                    <span
                        class="material-icons-round text-3xl group-hover:rotate-180 transition-transform duration-500">refresh</span>
                    <span class="sr-only">Retry</span>
                </button>
                <button data-nav-target="index.html"
                    class="flex-grow py-4 px-8 rounded-full border-2 border-primary text-primary bg-white dark:bg-transparent hover:bg-primary hover:text-white dark:hover:bg-primary dark:hover:text-white font-bold text-lg tracking-wider transition-all duration-300 shadow-soft transform active:scale-95 text-center">
                    返回首頁
                </button>
            </div>
        </div>
    </main>
    <script>
        // Parse URL score
        const urlParams = new URLSearchParams(window.location.search);
        const score = urlParams.get('score');
        if (score) {
            document.getElementById('final-score').textContent = score;
        }

        // Screenshot Logic
        document.getElementById('btn-share').addEventListener('click', async () => {
            const btnShare = document.getElementById('btn-share');
            const navButtons = document.querySelector('.flex-grow.bg-surface-light .flex'); // Target local nav buttons

            // Visual Flash Effect
            const flash = document.createElement('div');
            flash.className = 'flash-overlay';
            document.body.appendChild(flash);
            setTimeout(() => flash.remove(), 500);

            // Hide UI for clean shot
            btnShare.style.opacity = '0';
            if (navButtons) navButtons.style.opacity = '0';

            try {
                // Wait a moment for UI to hide and flash to clear (technically flash is overlay so we might want to wait slightly or ignore it)
                // Actually html2canvas might catch the flash if we are not careful.
                // Let's capture AFTER the flash starts fading but usually instant is better.
                // Re-think: Flash is for user feedback. Capture should happen BEFORE flash or ignore flash element?
                // Easiest is to hide flash element from canvas using ignoreElements if needed, but it's appended to body.
                // If we capture 'main' element, we avoid the flash overlay which is on body.

                const canvas = await html2canvas(document.querySelector('main'), {
                    backgroundColor: null, // Transparent bg if possible or inherit
                    scale: 2, // Better quality
                });

                const link = document.createElement('a');
                link.download = `duck-stack-score-${score || '0'}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            } catch (err) {
                console.error("Screenshot failed:", err);
                alert("截圖失敗，請稍後再試。");
            } finally {
                // Restore UI
                btnShare.style.opacity = '1';
                if (navButtons) navButtons.style.opacity = '1';
            }
        });
    </script>

</body>

</html>